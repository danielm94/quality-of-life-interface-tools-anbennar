#Before opening the upgrade building macro window
custom_button = {
	name = upgrade_building_macro_tab_window_closed
	tooltip = upgrade_building_macro_closed_tt
	potential = {
		owned_by = FROM
		FROM = {
			NOT = {
				has_country_flag = upgrade_building_macro_open
			}
			NOT = {
				has_country_flag = build_building_macro_open
			}
			NOT = {
				has_country_flag = delete_building_macro_open
			}
		}
	}
	trigger = {
	}
	effect = {
		FROM = {
			set_country_flag = upgrade_building_macro_open
			calculate_building_upgrade_costs = yes
		}
	}
}

#After opening the upgrade building macro window
#We do this because the macro window obstructs the tab to open it.
custom_button = {
	name = upgrade_building_macro_tab_window_opened
	tooltip = upgrade_building_macro_open_tt
	potential = {
		owned_by = FROM
		FROM = {
			OR = {
				has_country_flag = upgrade_building_macro_open
				has_country_flag = build_building_macro_open
				has_country_flag = delete_building_macro_open
			}
		}
	}
	trigger = {
	}
	frame = {
		number = 1
		trigger = {
			NOT = {
				FROM = {
					has_country_flag = upgrade_building_macro_open
				}
			}
		}
	}
	frame = {
		number = 2
		trigger = {
			FROM = {
				has_country_flag = upgrade_building_macro_open
			}
		}
	}
	effect = {
		FROM = {
			if = {
				limit = {
					NOT = {
						has_country_flag = upgrade_building_macro_open
					}
				}
				clr_country_flag = build_building_macro_open
				clr_country_flag = delete_building_macro_open
				set_country_flag = upgrade_building_macro_open
			}
			else = {
				clr_country_flag = upgrade_building_macro_open
			}
			calculate_building_upgrade_costs = yes
		}
	}
}

custom_button = {
	name = building_macro_close_button
	tooltip = empty_text
	potential = {
		owned_by = FROM
		FROM = {
			OR = {
				has_country_flag = upgrade_building_macro_open
				has_country_flag = build_building_macro_open
				has_country_flag = delete_building_macro_open
			}
		}
	}
	trigger = {
	}
	effect = {
		FROM = {
			clr_country_flag = upgrade_building_macro_open
			clr_country_flag = build_building_macro_open
			clr_country_flag = delete_building_macro_open
		}
	}
}

custom_window = {
	name = upgrade_building_macro_window
	potential = {
		owned_by = FROM
		FROM = {
			has_country_flag = upgrade_building_macro_open
		}
	}
}

custom_button = {
	name = upgrade_to_trade_depot_button
	tooltip = upgrade_to_trade_depot_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_trade_depot = yes
			any_owned_province = {
				has_building = marketplace
				can_build = trade_depot
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_trade_depot_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_trade_buildings_to_trade_depots = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_stock_exchange_button
	tooltip = upgrade_to_stock_exchange_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_stock_exchange = yes
			any_owned_province = {
				OR = {
					has_building = marketplace
					has_building = trade_depot
				}
				can_build = stock_exchange
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_stock_exchange_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_trade_buildings_to_stock_exchanges = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_town_hall_button
	tooltip = upgrade_to_town_hall_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_town_hall = yes
			any_owned_province = {
				has_building = courthouse
				can_build = town_hall
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_town_hall_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_government_buildings_to_town_halls = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_drydock_button
	tooltip = upgrade_to_drydock_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_drydock = yes
			any_owned_province = {
				has_building = dock
				can_build = drydock
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_drydock_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_dock_buildings_to_dry_docks = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_grand_shipyard_button
	tooltip = upgrade_to_grand_shipyard_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_grand_shipyard = yes
			any_owned_province = {
				has_building = shipyard
				can_build = grand_shipyard
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_grand_shipyard_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_shipyard_buildings_to_grand_shipyards = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_counting_house_button
	tooltip = upgrade_to_counting_house_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_counting_house = yes
			any_owned_province = {
				has_building = workshop
				can_build = counting_house
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_counting_house_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_workshop_buildings_to_counting_houses = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_training_fields_button
	tooltip = upgrade_to_training_fields_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_training_fields = yes
			any_owned_province = {
				has_building = barracks
				can_build = training_fields
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_training_fields_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_manpower_buildings_to_training_fields = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_conscription_center_button
	tooltip = upgrade_to_conscription_center_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_conscription_center = yes
			any_owned_province = {
				has_building = regimental_camp
				can_build = conscription_center
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_conscription_center_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_force_limit_buildings_to_conscription_center = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_cathedral_button
	tooltip = upgrade_to_cathedral_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_cathedral = yes
			any_owned_province = {
				has_building = temple
				can_build = cathedral
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_cathedral_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_tax_buildings_to_cathedrals = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_fort_16th_button
	tooltip = upgrade_to_fort_16th_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_fort_16th = yes
			any_owned_province = {
				has_building = fort_15th
				can_build = fort_16th
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_fort_16th_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_fort_buildings_to_level_4_fort = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_fort_17th_button
	tooltip = upgrade_to_fort_17th_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_fort_17th = yes
			any_owned_province = {
				OR = {
					has_building = fort_15th
					has_building = fort_16th
				}
				can_build = fort_17th
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_fort_17th_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_fort_buildings_to_level_6_fort = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_fort_18th_button
	tooltip = upgrade_to_fort_18th_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_fort_18th = yes
			any_owned_province = {
				OR = {
					has_building = fort_15th
					has_building = fort_16th
					has_building = fort_17th
				}
				can_build = fort_18th
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_fort_18th_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_fort_buildings_to_level_8_fort = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_to_naval_battery_button
	tooltip = upgrade_to_naval_battery_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			can_afford_to_upgrade_naval_battery = yes
			any_owned_province = {
				has_building = coastal_defence
				can_build = naval_battery
				NOT = {
					has_construction = any
				}
			}
		}
	}
	effect = {
		if = {
			limit = {
				FROM = {
					has_country_flag = enable_smart_upgrade_building_macro
				}
			}
			custom_tooltip = upgrade_to_naval_battery_effect_tt
		}
		else = {
			custom_tooltip = upgrade_building_anywhere_possible_tt
		}
		hidden_effect = {
			FROM = {
				upgrade_all_coastal_defenses_to_naval_battery = yes
			}
		}
	}
}

custom_button = {
	name = upgrade_macro_cancel_button
	tooltip = building_macro_cancel_button_tt
	potential = {
	}
	trigger = {
		FROM = {
			hidden_trigger = {
				NOT = {
					has_country_flag = in_building_macro_settings
				}
			}
			any_owned_province = {
				has_construction = building
			}
		}
	}
	effect = {
		FROM = {
			set_country_flag = in_building_macro_settings
			country_event = {
				id = cancel_construction_events.1
			}
		}
	}
}

custom_button = {
	name = upgrade_building_macro_settings_button
	tooltip = upgrade_building_macro_settings_button_tt
	potential = {
	}
	trigger = {
		hidden_trigger = {
			NOT = {
				FROM = {
					has_country_flag = in_building_macro_settings
				}
			}
		}
	}
	effect = {
		FROM = {
			set_country_flag = in_building_macro_settings
			country_event = {
				id = upgrade_building_macro_settings_event.1
			}
		}
	}
}

custom_text_box = {
	name = upgrade_to_trade_depot_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_stock_exchange_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_town_hall_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_drydock_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_grand_shipyard_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_counting_house_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_training_fields_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_conscription_center_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_cathedral_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_fort_16th_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_fort_17th_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_fort_18th_cost
	potential = {
	}
	tooltip = empty_text
}

custom_text_box = {
	name = upgrade_to_naval_battery_cost
	potential = {
	}
	tooltip = empty_text
}